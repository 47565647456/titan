name: Bot Trigger
on:
  issue_comment:
    types: [created]

jobs:
  trigger-ci:
    # Only run if it's a PR comment and starts with /test
    if: github.event.issue.pull_request && startsWith(github.event.comment.body, '/test')
    runs-on: ubuntu-latest
    permissions:
      contents: read
      actions: write
      pull-requests: write # Needed to comment back
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Trigger CI
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.issue.number }}
        run: |
          # Get branch name from PR
          BRANCH=$(gh pr view $PR_NUMBER --json headRefName -q .headRefName)
          echo "Triggering CI for branch: $BRANCH"
          
          # Trigger the CI workflow
          gh workflow run ci.yml --ref "$BRANCH"
          
          # Add a reaction or comment to confirm
          gh pr comment $PR_NUMBER --body "ðŸš€ CI Workflow manually triggered for branch \`$BRANCH\`! [View Actions](/47565647456/titan/actions)"
