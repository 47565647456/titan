#!/bin/sh

echo "--------------------------------------------------------"
echo "Running pre-push hook: Local Tests"
echo "--------------------------------------------------------"

# Navigate to Source directory where the solution is
# $GIT_PREFIX is not reliably set in all hook contexts, so we proceed relative to root
# Git hooks run from the root of the repo
cd Source || exit 1

# Run tests
# We don't force a database here; it will default to in-memory if USE_DATABASE is not set.
# This ensures fast checks before push.
dotnet test

# Capture exit code
RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo "--------------------------------------------------------"
    echo "❌ Tests FAILED. Push aborted."
    echo "   Please fix the tests or use 'git push --no-verify' to bypass."
    echo "--------------------------------------------------------"
    exit 1
fi

echo "--------------------------------------------------------"
echo "✅ Tests PASSED. Proceeding with push."
echo "--------------------------------------------------------"
exit 0
